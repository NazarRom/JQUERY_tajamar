<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <!DOCTYPE html>
  <html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
  </head>

  <body>
    <h1>Ejemplo CRUD jquey json</h1>

    <!--<label>Id: </label><br />
    <input type="text" id="cajaid" /><br />
    <!--Parsear

    <label>Nombre: </label><br />
    <input type="text" id="cajanombre" /><br />

    <label>Dirección</label><br />
    <input type="text" id="cajadireccion" /><br />

    <label>Teléfono: </label><br />
    <input type="text" id="cajatelefono" /><br />
    <!--Parsear

    <label>Camas: </label><br />
    <input type="text" id="cajacamas" /><br /><br />
    <!--Parsear-->



    <!--<button type="button" id="botoninsertar">Insertar</button><br />
    <button type="button" id="botonmodificar">Modificar</button><br />
    <button type="button" id="botoneliminar">Eliminar</button><br />
    <hr />-->

    <table border="1px" id="tablahospitales">
      <thead>
        <tr>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <script src="js/jquery-3.6.1.min.js"></script>
    <script>
      var url = "https://apicrudhospital.azurewebsites.net/";




      function cargarHospitales() {
        var request = "/webresources/hospitales";
        $.ajax({
          "url": url + request,
          "method": "GET",
          "dataType": "json"
          , success: function (data) {
            var boton = $("<button>", {
                        "type": "button",
                        
                    });
            var html = "";
            html += "<tr>";
            html += "<th>Id</th>";
            html += "<th>Nombre</th>";
            html += "<th>telefono</th>";
            html += "<th>direccion</th>";
            html += "<th>camas</th>";
            html += "</tr>";

            $.each(data, function (index, hosp) {

              console.log("dentro");

              html += "<tr>";
              html += "<td>" + hosp.idhospital + "</td>";
              html += "<td>" + hosp.nombre + "</td>";
              html += "<td>" + hosp.telefono + "</td>";
              html += "<td>" + hosp.direccion + "</td>";
              html += "<td>" + hosp.camas + "</td>";

              html += "</tr>";

            });
            $("#tablahospitales tbody").html(html);

          }

        });
      }

      function getJsonHospi() {
        var id = parseInt($("#cajaid").val());
        var nom = $("#cajanombre").val();
        var dir = $("#cajadireccion").val();
        var tel = $("#cajatelefono").val();
        var cama = $("#cajacamas").val();

        var hospi = new Object();

        hospi.idhospital = id;
        hospi.nombre = nom;
        hospi.direccion = dir;
        hospi.telefono = tel;
        hospi.camas = cama;

        var dataJson = JSON.stringify(hospi);
        return dataJson;
      }



      $(document).ready(function () {
        cargarHospitales();

        $("#botoninsertar").click(function () {

          var id = parseInt($("#cajaid").val());
          var nom = $("#cajanombre").val();
          var dir = $("#cajadireccion").val();
          var tel = $("#cajatelefono").val();
          var cama = $("#cajacamas").val();

          //debemos enviar un objeto json al metodo post
          //creamos un nuevo objeto javascript
          var hospi = new Object();
          //las propiedades deben coincidir con el servicio
          hospi.idhospital = id;
          hospi.nombre = nom;
          hospi.direccion = dir;
          hospi.telefono = tel;
          hospi.camas = cama;
          //el objeto cerado debemos transformalro al formato
          //del servicio : JSON
          //para transformar a json : JSON.stringfy(OBJETO)
          var dataJson = JSON.stringify(hospi);
          console.log(dataJson);
          //las peticiones no get utilizan $.ajax
          //si enviamos informacion al servicio debemos
          //incluir dos elementos mas dentro de $.ajax
          // contentType : el tipo de dato a enviar
          //--data el objeto a enviar
          var request = "/webresources/hospitales/put";
          $.ajax({
            "url": url + request,
            "type": "POST",
            "data": dataJson,
            "contentType": "application/json",
            success: function () {
              console.log("insertado");
              cargarHospitales();
            }
          });
        });
      });
    </script>
  </body>

  </html>
</body>

</html>